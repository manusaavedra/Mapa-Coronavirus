<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./static/css/styles.css">
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet' />
    <title>Map - Covid 19</title>
</head>
<body>
    <h2 class="map-title">Mapa Covid - 19</h2>
    <div id="map"></div>
    <script>

        async function getData() {
            
            const data = await fetch('http://master-covid-19-api-laeyoung.endpoint.ainize.ai/jhu-edu/latest')
            const response = await data.json()

            return response;
        }

        function renderPopup(item) {
            return `
                <h2>${item.countryregion} ${item.provincestate} </h2>
                <p><b>casos confirmados:</b>${item.confirmed}</p>
                <p><b>muertes:</b>${item.deaths}</p>
                <p><b>recuperados:</b>${item.recovered}</p>
            `
        }

        async function render() {
            
            document.getElementById("map").innerHTML = `
                <div class="loading"><span>cargando datos desde que inici√≥ la pandemia...</span></div>
            `

            const data = await getData()
            
            console.log(data)

            mapboxgl.accessToken = 'pk.eyJ1IjoibWFudXNhYXYzZHJhIiwiYSI6ImNramxpam8xdzBvcnkycnMyM2tqb3U1YnUifQ.sgrb1Z5zBCkoI85LUyn2lA';
            
            const map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/dark-v10',
                zoom: 2
            });

            const popup = new mapboxgl.Popup()

            

            const Icon = {
                'url': './static/img/marker-icon.png',
                'size': {
                    'width': 20,
                    'height': 20
                }
            }

            data.map((item) => {

                const MarkerElement = document.createElement('div')
                MarkerElement.className = 'marker__icon'
                MarkerElement.style.backgroundImage = `url('${Icon.url}')`
                MarkerElement.style.backgroundSize = Icon.size.width + 'px'
                MarkerElement.style.width = Icon.size.width + 'px'
                MarkerElement.style.height = Icon.size.height + 'px'

                let latitud = item.location.lat
                let longitud = item.location.lng

                       
                const marker = new mapboxgl.Marker(MarkerElement)
                    .setLngLat([longitud, latitud])
                    .setPopup(new mapboxgl.Popup().setHTML(renderPopup(item)))
                    .addTo(map);
                
            })
        }

        render()
        

        
    </script>
</body>
</html>